<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Comissões</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .login-container {
            padding: 40px;
            text-align: center;
            max-width: 400px;
            margin: 0 auto;
        }

        .login-form {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-success {
            background: #28a745;
        }

        .dashboard {
            display: none;
            padding: 30px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e1e5e9;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            text-align: center;
        }

        .card h3 {
            color: #495057;
            margin-bottom: 10px;
        }

        .card .value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }

        .sales-section, .ranking-section, .admin-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .sales-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .sales-table th,
        .sales-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .sales-table th {
            background-color: #e9ecef;
            font-weight: 600;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            position: relative;
        }

        .close {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
        }

        .close:hover {
            color: #000;
        }

        .error {
            color: #dc3545;
            background: #f8d7da;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }

        .ranking-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .ranking-item.current-user {
            border-left-color: #28a745;
            background: #d4edda;
        }

        .position {
            font-weight: bold;
            font-size: 1.2rem;
            color: #667eea;
        }

        .commission-rules {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .rule-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .container {
                width: 95%;
                margin: 10px;
            }
            
            .dashboard {
                padding: 15px;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
            }
            
            .cards-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Tela de Login -->
        <div id="login-screen" class="login-container">
            <h1>Sistema de Comissões</h1>
            <div class="login-form">
                <div class="form-group">
                    <label for="userType">Tipo de Usuário:</label>
                    <select id="userType">
                        <option value="vendedor">Vendedor</option>
                        <option value="admin">Administrador</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="username">Usuário:</label>
                    <input type="text" id="username" placeholder="Digite seu usuário">
                </div>
                
                <div class="form-group">
                    <label for="password">Senha:</label>
                    <input type="password" id="password" placeholder="Digite sua senha">
                </div>
                
                <button class="btn" onclick="login()">Entrar</button>
                <div id="login-error" class="error" style="display: none;"></div>
            </div>
        </div>

        <!-- Dashboard do Vendedor -->
        <div id="vendedor-dashboard" class="dashboard">
            <div class="header">
                <div>
                    <h1>Dashboard - <span id="vendedor-name"></span></h1>
                </div>
                <div class="user-info">
                    <button class="btn btn-danger" onclick="logout()">Sair</button>
                </div>
            </div>

            <div class="cards-container">
                <div class="card">
                    <h3>Total de Vendas</h3>
                    <div class="value" id="total-vendas">0</div>
                </div>
                <div class="card">
                    <h3>Comissão Total</h3>
                    <div class="value" id="total-comissao">R$ 0,00</div>
                </div>
                <div class="card">
                    <h3>Posição no Ranking</h3>
                    <div class="value" id="posicao-ranking">-</div>
                </div>
            </div>

            <div class="sales-section">
                <h2>Minhas Vendas</h2>
                <table class="sales-table">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Cliente</th>
                            <th>Valor</th>
                            <th>Comissão</th>
                        </tr>
                    </thead>
                    <tbody id="vendas-vendedor">
                        <tr>
                            <td colspan="4" style="text-align: center; color: #666;">Nenhuma venda encontrada</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="ranking-section">
                <h2>Ranking da Equipe</h2>
                <div id="ranking-list"></div>
            </div>
        </div>

        <!-- Dashboard do Admin -->
        <div id="admin-dashboard" class="dashboard">
            <div class="header">
                <div>
                    <h1>Painel Administrativo</h1>
                </div>
                <div class="user-info">
                    <button class="btn btn-success" onclick="openNewSaleModal()">+ Nova Venda</button>
                    <button class="btn btn-secondary" onclick="openCommissionRulesModal()">Regras de Comissão</button>
                    <button class="btn btn-danger" onclick="logout()">Sair</button>
                </div>
            </div>

            <div class="cards-container">
                <div class="card">
                    <h3>Total Geral de Vendas</h3>
                    <div class="value" id="admin-total-vendas">0</div>
                </div>
                <div class="card">
                    <h3>Comissões Pagas</h3>
                    <div class="value" id="admin-total-comissoes">R$ 0,00</div>
                </div>
                <div class="card">
                    <h3>Vendedores Ativos</h3>
                    <div class="value" id="admin-vendedores-ativos">0</div>
                </div>
            </div>

            <div class="admin-section">
                <h2>Todas as Vendas</h2>
                <table class="sales-table">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Vendedor</th>
                            <th>Cliente</th>
                            <th>Valor</th>
                            <th>Comissão</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="todas-vendas">
                    </tbody>
                </table>
            </div>

            <div class="ranking-section">
                <h2>Ranking Completo</h2>
                <div id="admin-ranking-list"></div>
            </div>
        </div>
    </div>

    <!-- Modal Nova Venda -->
    <div id="newSaleModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeNewSaleModal()">&times;</span>
            <h2>Nova Venda</h2>
            <div class="form-group">
                <label for="vendedor-select">Vendedor:</label>
                <select id="vendedor-select"></select>
            </div>
            <div class="form-group">
                <label for="cliente-input">Cliente:</label>
                <input type="text" id="cliente-input" placeholder="Nome do cliente">
            </div>
            <div class="form-group">
                <label for="valor-input">Valor da Venda:</label>
                <input type="number" id="valor-input" placeholder="0,00" step="0.01">
            </div>
            <div class="form-group">
                <label for="comissao-input">% Comissão:</label>
                <input type="number" id="comissao-input" placeholder="5" step="0.1" min="0" max="100">
            </div>
            <button class="btn" onclick="addSale()">Adicionar Venda</button>
        </div>
    </div>

    <!-- Modal Regras de Comissão -->
    <div id="commissionRulesModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCommissionRulesModal()">&times;</span>
            <h2>Regras de Comissão</h2>
            <div class="commission-rules">
                <div id="rules-list"></div>
                <h3>Nova Regra</h3>
                <div class="form-group">
                    <label for="rule-name">Nome da Regra:</label>
                    <input type="text" id="rule-name" placeholder="Ex: Vendas até R$ 1000">
                </div>
                <div class="form-group">
                    <label for="rule-percentage">Percentual (%):</label>
                    <input type="number" id="rule-percentage" placeholder="5" step="0.1" min="0" max="100">
                </div>
                <button class="btn btn-success" onclick="addCommissionRule()">Adicionar Regra</button>
            </div>
        </div>
    </div>

    <script>
        // Dados do sistema (simulando banco de dados)
        let currentUser = null;
        let salesData = [];
        let users = [
            { username: 'joao', password: '123', type: 'vendedor', name: 'João Silva' },
            { username: 'maria', password: '123', type: 'vendedor', name: 'Maria Santos' },
            { username: 'pedro', password: '123', type: 'vendedor', name: 'Pedro Costa' },
            { username: 'admin', password: 'admin123', type: 'admin', name: 'Administrador' }
        ];
        let commissionRules = [
            { name: 'Padrão', percentage: 5 },
            { name: 'Vendas acima de R$ 5000', percentage: 7 },
            { name: 'Vendas acima de R$ 10000', percentage: 10 }
        ];

        // Função de login
        function login() {
            const userType = document.getElementById('userType').value;
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('login-error');

            const user = users.find(u => 
                u.username === username && 
                u.password === password && 
                u.type === userType
            );

            if (user) {
                currentUser = user;
                document.getElementById('login-screen').style.display = 'none';
                
                if (userType === 'vendedor') {
                    showVendedorDashboard();
                } else {
                    showAdminDashboard();
                }
                
                errorDiv.style.display = 'none';
            } else {
                errorDiv.textContent = 'Usuário, senha ou tipo incorretos!';
                errorDiv.style.display = 'block';
            }
        }

        // Função de logout
        function logout() {
            currentUser = null;
            document.getElementById('login-screen').style.display = 'block';
            document.getElementById('vendedor-dashboard').style.display = 'none';
            document.getElementById('admin-dashboard').style.display = 'none';
            
            // Limpar campos
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // Mostrar dashboard do vendedor
        function showVendedorDashboard() {
            document.getElementById('vendedor-dashboard').style.display = 'block';
            document.getElementById('vendedor-name').textContent = currentUser.name;
            
            updateVendedorStats();
            loadVendedorSales();
            loadRanking();
        }

        // Mostrar dashboard do admin
        function showAdminDashboard() {
            document.getElementById('admin-dashboard').style.display = 'block';
            
            updateAdminStats();
            loadAllSales();
            loadAdminRanking();
            populateVendedorSelect();
        }

        // Atualizar estatísticas do vendedor
        function updateVendedorStats() {
            const vendedorSales = salesData.filter(sale => sale.vendedor === currentUser.username);
            const totalVendas = vendedorSales.length;
            const totalComissao = vendedorSales.reduce((sum, sale) => sum + sale.comissaoValor, 0);
            
            document.getElementById('total-vendas').textContent = totalVendas;
            document.getElementById('total-comissao').textContent = formatCurrency(totalComissao);
            
            // Calcular posição no ranking
            const ranking = calculateRanking();
            const position = ranking.findIndex(item => item.vendedor === currentUser.username) + 1;
            document.getElementById('posicao-ranking').textContent = position > 0 ? `${position}º` : '-';
        }

        // Carregar vendas do vendedor
        function loadVendedorSales() {
            const tbody = document.getElementById('vendas-vendedor');
            const vendedorSales = salesData.filter(sale => sale.vendedor === currentUser.username);
            
            if (vendedorSales.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #666;">Nenhuma venda encontrada</td></tr>';
                return;
            }
            
            tbody.innerHTML = vendedorSales.map(sale => `
                <tr>
                    <td>${formatDate(sale.data)}</td>
                    <td>${sale.cliente}</td>
                    <td>${formatCurrency(sale.valor)}</td>
                    <td>${formatCurrency(sale.comissaoValor)} (${sale.comissaoPerc}%)</td>
                </tr>
            `).join('');
        }

        // Carregar ranking
        function loadRanking() {
            const ranking = calculateRanking();
            const container = document.getElementById('ranking-list');
            
            container.innerHTML = ranking.map((item, index) => {
                const isCurrentUser = item.vendedor === currentUser.username;
                const displayName = isCurrentUser ? currentUser.name : `Vendedor ${String.fromCharCode(65 + index)}`;
                
                return `
                    <div class="ranking-item ${isCurrentUser ? 'current-user' : ''}">
                        <div>
                            <span class="position">${index + 1}º</span>
                            <strong>${displayName}</strong>
                        </div>
                        <div>
                            <span>${item.totalVendas} vendas</span> | 
                            <span>${formatCurrency(item.totalComissao)}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Atualizar estatísticas do admin
        function updateAdminStats() {
            const totalVendas = salesData.length;
            const totalComissoes = salesData.reduce((sum, sale) => sum + sale.comissaoValor, 0);
            const vendedoresAtivos = new Set(salesData.map(sale => sale.vendedor)).size;
            
            document.getElementById('admin-total-vendas').textContent = totalVendas;
            document.getElementById('admin-total-comissoes').textContent = formatCurrency(totalComissoes);
            document.getElementById('admin-vendedores-ativos').textContent = vendedoresAtivos;
        }

        // Carregar todas as vendas (admin)
        function loadAllSales() {
            const tbody = document.getElementById('todas-vendas');
            
            if (salesData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #666;">Nenhuma venda encontrada</td></tr>';
                return;
            }
            
            tbody.innerHTML = salesData.map((sale, index) => {
                const vendedorName = users.find(u => u.username === sale.vendedor)?.name || sale.vendedor;
                return `
                    <tr>
                        <td>${formatDate(sale.data)}</td>
                        <td>${vendedorName}</td>
                        <td>${sale.cliente}</td>
                        <td>${formatCurrency(sale.valor)}</td>
                        <td>${formatCurrency(sale.comissaoValor)} (${sale.comissaoPerc}%)</td>
                        <td>
                            <button class="btn btn-danger btn-small" onclick="deleteSale(${index})">Excluir</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Carregar ranking admin
        function loadAdminRanking() {
            const ranking = calculateRanking();
            const container = document.getElementById('admin-ranking-list');
            
            container.innerHTML = ranking.map((item, index) => {
                const vendedorName = users.find(u => u.username === item.vendedor)?.name || item.vendedor;
                
                return `
                    <div class="ranking-item">
                        <div>
                            <span class="position">${index + 1}º</span>
                            <strong>${vendedorName}</strong>
                        </div>
                        <div>
                            <span>${item.totalVendas} vendas</span> | 
                            <span>${formatCurrency(item.totalComissao)}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Calcular ranking
        function calculateRanking() {
            const vendedorStats = {};
            
            salesData.forEach(sale => {
                if (!vendedorStats[sale.vendedor]) {
                    vendedorStats[sale.vendedor] = {
                        vendedor: sale.vendedor,
                        totalVendas: 0,
                        totalComissao: 0
                    };
                }
                
                vendedorStats[sale.vendedor].totalVendas++;
                vendedorStats[sale.vendedor].totalComissao += sale.comissaoValor;
            });
            
            return Object.values(vendedorStats)
                .sort((a, b) => b.totalComissao - a.totalComissao);
        }

        // Abrir modal nova venda
        function openNewSaleModal() {
            document.getElementById('newSaleModal').style.display = 'block';
        }

        // Fechar modal nova venda
        function closeNewSaleModal() {
            document.getElementById('newSaleModal').style.display = 'none';
            clearNewSaleForm();
        }

        // Limpar formulário nova venda
        function clearNewSaleForm() {
            document.getElementById('vendedor-select').value = '';
            document.getElementById('cliente-input').value = '';
            document.getElementById('valor-input').value = '';
            document.getElementById('comissao-input').value = '';
        }

        // Popular select de vendedores
        function populateVendedorSelect() {
            const select = document.getElementById('vendedor-select');
            const vendedores = users.filter(u => u.type === 'vendedor');
            
            select.innerHTML = '<option value="">Selecione um vendedor</option>' +
                vendedores.map(v => `<option value="${v.username}">${v.name}</option>`).join('');
        }

        // Adicionar nova venda
        function addSale() {
            const vendedor = document.getElementById('vendedor-select').value;
            const cliente = document.getElementById('cliente-input').value;
            const valor = parseFloat(document.getElementById('valor-input').value);
            const comissaoPerc = parseFloat(document.getElementById('comissao-input').value);
            
            if (!vendedor || !cliente || !valor || !comissaoPerc) {
                alert('Preencha todos os campos!');
                return;
            }
            
            const comissaoValor = (valor * comissaoPerc) / 100;
            
            const newSale = {
                data: new Date(),
                vendedor: vendedor,
                cliente: cliente,
                valor: valor,
                comissaoPerc: comissaoPerc,
                comissaoValor: comissaoValor
            };
            
            salesData.push(newSale);
            closeNewSaleModal();
            updateAdminStats();
            loadAllSales();
            loadAdminRanking();
        }

        // Excluir venda
        function deleteSale(index) {
            if (confirm('Tem certeza que deseja excluir esta venda?')) {
                salesData.splice(index, 1);
                updateAdminStats();
                loadAllSales();
                loadAdminRanking();
            }
        }

        // Modal regras de comissão
        function openCommissionRulesModal() {
            document.getElementById('commissionRulesModal').style.display = 'block';
            loadCommissionRules();
        }

        function closeCommissionRulesModal() {
            document.getElementById('commissionRulesModal').style.display = 'none';
        }

        function loadCommissionRules() {
            const container = document.getElementById('rules-list');
            container.innerHTML = commissionRules.map((rule, index) => `
                <div class="rule-item">
                    <span><strong>${rule.name}:</strong> ${rule.percentage}%</span>
                    <button class="btn btn-danger btn-small" onclick="deleteCommissionRule(${index})">Excluir</button>
                </div>
            `).join('');
        }

        function addCommissionRule() {
            const name = document.getElementById('rule-name').value;
            const percentage = parseFloat(document.getElementById('rule-percentage').value);
            
            if (!name || !percentage) {
                alert('Preencha todos os campos!');
                return;
            }
            
            commissionRules.push({ name, percentage });
            document.getElementById('rule-name').value = '';
            document.getElementById('rule-percentage').value = '';
            loadCommissionRules();
        }

        function deleteCommissionRule(index) {
            if (confirm('Tem certeza que deseja excluir esta regra?')) {
                commissionRules.splice(index, 1);
                loadCommissionRules();
            }
        }

        // Funções utilitárias
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        function formatDate(date) {
            return new Date(date).toLocaleDateString('pt-BR');
        }

        // Event listeners
        document.getElementById('password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                login();
            }
        });

        // Fechar modais ao clicar fora
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Dados de exemplo para demonstração
        salesData = [
            {
                data: new Date('2024-01-15'),
                vendedor: 'joao',
                cliente: 'Empresa ABC',
                valor: 5000,
                comissaoPerc: 5,
                comissaoValor: 250
            },
            {
                data: new Date('2024-01-20'),
                vendedor: 'maria',
                cliente: 'Empresa XYZ',
                valor: 8000,
                comissaoPerc: 7,
                comissaoValor: 560
            },
            {
                data: new Date('2024-01-25'),
                vendedor: 'joao',
                cliente: 'Empresa DEF',
                valor: 3000,
                comissaoPerc: 5,
                comissaoValor: 150
            }
        ];
    </script>
</body>
</html>
